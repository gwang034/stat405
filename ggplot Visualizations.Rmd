---
title: "ggplot Visualizations"
author: "Grace Wang, Virginia Baskin, Siddhi Narayan"
date: "2023-02-26"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load in Stuff, include=FALSE}

library(ggplot2)
library(readr)
mini_htx <- read_csv("Datasets/mini_htx.csv")

```

## Plot 1: Yearly Citations by Race
```{r, include=FALSE}
# yearly citations stacked by race
race_date <- mini_htx[,c("date", "subject_race")] # race and date
race_date <- na.omit(race_date) # omit na Values

year_only <- function(fulldate){
  year <- substring(fulldate, 1, 4) # only keep year
}
race_date$date <- unlist(lapply(race_date$date, year_only))
make_factor <- (race_date$date)

race_date <- as.data.frame(table(race_date))

# Stacked
ggplot(race_date, aes(fill=subject_race, y=Freq, x=date))+geom_bar(position="stack", stat="identity")+ggtitle("Police Citations in Houston 2014-2020 by Race")+xlab("Year")+ylab("Citations")+guides(fill=guide_legend(title='Subject Race'))

```

## Plot 2: MPH over Speed Limit for Speeding Citations 2014-2020
with marginal histogram 
virginia 

```{r}
mini_htx2 <- mini_htx
mini_htx2$diff <- (mini_htx2$speed - mini_htx2$posted_speed)
diff <- mini_htx2$diff


test <- ggplot(mini_htx2, aes(date, diff)) 
test + geom_point(width = .5, size=1) +
  labs(subtitle="mpg: city vs highway mileage", 
       y="hwy", 
       x="cty", 
       title="Jittered Points")

  
g <- ggplot(mini_htx2, aes(x=date, y=diff)) + geom_point()
g + geom_point() + 
  labs(subtitle="mpg: city vs highway mileage", 
       y="diff", 
       x="date", 
       title="Scatterplot with overlapping points", 
       caption="Source: midwest")

ggMarginal(g, type = "histogram", fill="transparent")
ggMarginal(g, type = "boxplot", fill="transparent")

##OLD
plot(mini_htx2$date, mini_htx2$diff, main = "MPH over Limit for Speeding Citations 2014-2020", 
     xlab = "Year", ylab = "MPH Speeding", pch = ".", panel.first = grid(10,10),ylim = c(0,100), 
     col = ifelse((diff <= 5), "dark green", 
                    ifelse((diff <= 10), "blue", 
                           ifelse((diff <= 15), "purple",
                                  ifelse((diff <= 20), "red", "dark orange")))))

legend("topleft", legend = c("0-5 mph", "6-10 mph", "11-15 mph", "16-20 mph", ">20 mph"), 
       col = c("dark green", "blue", "purple", "red", "dark orange"), pch = ".", cex = 0.7)
##
```

## Plot 3: Citations by month stacked by district
```{r Citations per Month by District}
library(ggplot2)
mini_htx$month <- format(as.Date(mini_htx$date, format="%d/%m/%Y"),"%m")
mon_cit_dist <- data.frame(month = mini_htx$month, district = mini_htx$district)
mon_cit_dist <- na.omit(mon_cit_dist)
ggplot(data = mon_cit_dist, aes(x = month, fill = district)) + stat_count() + facet_wrap(~district, ncol= 4, nrow = 6)
```
This plot describes the amount of citations per month. Each mini plot describes an individual district. District 2 has over all the highest number of citations, while District 21 has basically no citations, and is therefore not included in the plot (District 21 is IAH airport, which is important to note). The distribution of citations across months is varied between districts -- some of them have higher citations in the middle of the year, while others have more citations in the beginning or end of the year, while some a relatively evenly distributed.


## Plot 4: MPH over Speed Limit by Race and Gender
```{r, include=FALSE}
mini_htx4 <- na.omit(mini_htx2[,c("subject_race", "date", "diff", "subject_sex")])

ggplot(mini_htx4, aes(fill=factor(subject_sex),subject_race, diff)) + geom_violin() + labs(title="MPH over Speed Limit for Citation", x="Subject Race",y="MPH Speeding")+guides(fill=guide_legend(title='Subject Sex'))

```

## Plot 5: Citations by District and Gender
virginia


## Plot 6: Citations by Race
```{r Race to citation ratio}
df <- data.frame(table(na.omit(mini_htx$subject_race)))
total_freq <- sum(df$Freq)
df$prop <- df$Freq/total_freq
num_squares <- round(df$prop*100)


df_grid <- data.frame(
 x = rep(1:10, each = 10),
 y = rep(1:10, times = 10)
)


df_grid$category <- rep(df$Var1, num_squares)
ggplot(df_grid, aes(x = x, y = y, fill = category)) +
 geom_tile(color = "black", size = 0.5) +
 scale_fill_brewer(palette = "Set3") +
 labs(title="Waffle Chart of Citations per Race")+
 theme_void()
```

Now we will look at the % of Citation by Race. As we can see, white individuals have the highest percentage of citations, followed by black individuals, and then Asian/pacific islanders, then unknown races. This is somewhat proportional to the actual demographics of Houston (according to the U.S. census) â€“ the White and Black percentages of citations are slightly higher than their population in Houston, while the proportion of citations for Asian individuals is slightly lower than the proportion of Asian people in Houston.