---
title: "ggplot Visualizations"
author: "Grace Wang, Virginia Baskin, Siddhi Narayan"
date: "2023-02-26"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load in Stuff, include=FALSE}

library(ggplot2)
library(readr)
library(ggExtra)
mini_htx <- read_csv("Datasets/mini_htx.csv")

```

## Plot 1: Yearly Citations by Race
```{r, include=FALSE}
# yearly citations stacked by race
race_date <- mini_htx[,c("date", "subject_race")] # race and date
race_date <- na.omit(race_date) # omit na Values

year_only <- function(fulldate){
  year <- substring(fulldate, 1, 4) # only keep year
}
race_date$date <- unlist(lapply(race_date$date, year_only))
make_factor <- (race_date$date)

race_date <- as.data.frame(table(race_date))

# Stacked
ggplot(race_date, aes(fill=subject_race, y=Freq, x=date))+geom_bar(position="stack", stat="identity")+ggtitle("Police Citations in Houston 2014-2020 by Race")+xlab("Year")+ylab("Citations")+guides(fill=guide_legend(title='Subject Race'))

```

## Plot 2: MPH over Speed Limit for Speeding Citations 2014-2020
with marginal histogram 
Virginia 

```{r, include=FALSE}
mini_htx2 <- mini_htx
mini_htx2$diff <- (mini_htx2$speed - mini_htx2$posted_speed)
mini_htx3 <- mini_htx2[, c("date", "diff")]
mini_htx3 <- na.omit(mini_htx3)
library(ggExtra)

plot2 <- ggplot(mini_htx3, aes(date, diff)) + geom_point(size=1) +
  labs(subtitle="Frequency of Citations for Different Levels of Speeding", 
       y="MPH Speeding", 
       x="Year", 
       title="MPH over Limit for Speeding Citations 2014-2020")

ggMarginal(plot2, type = "histogram", fill="slateblue", margins = 'y')
ggMarginal(plot2, type = "boxplot", fill="slateblue", margins = 'y')
ggMarginal(plot2, color ="slateblue", margins = 'y')
```

## Plot 3: Citations by month stacked by district
```{r Citations per Month by District}
library(ggplot2)
mini_htx$month <- format(as.Date(mini_htx$date, format="%d/%m/%Y"),"%m")
mon_cit_dist <- data.frame(month = mini_htx$month, district = mini_htx$district)
mon_cit_dist <- na.omit(mon_cit_dist)
ggplot(data = mon_cit_dist, aes(x = month, fill = district)) + stat_count() + facet_wrap(~district, ncol= 4, nrow = 6)
```
This plot describes the amount of citations per month. Each mini plot describes an individual district. District 2 has over all the highest number of citations, while District 21 has basically no citations, and is therefore not included in the plot (District 21 is IAH airport, which is important to note). The distribution of citations across months is varied between districts -- some of them have higher citations in the middle of the year, while others have more citations in the beginning or end of the year, while some a relatively evenly distributed.


## Plot 4: MPH over Speed Limit by Race and Gender
```{r, include=FALSE}
mini_htx4 <- na.omit(mini_htx2[,c("subject_race", "date", "diff", "subject_sex")])

ggplot(mini_htx4, aes(fill=factor(subject_sex),subject_race, diff)) + geom_violin() + labs(title="MPH over Speed Limit for Citation", x="Subject Race",y="MPH Speeding")+guides(fill=guide_legend(title='Subject Sex'))

```

## Plot 5: Citations by District and Gender
Virginia

```{r, include=FALSE}
#x axis citation number, y axis is district, color is gender

library(ggthemes)
options(scipen = 999)  # turns of scientific notations like 1e+40
email_campaign_funnel <- read.csv("https://raw.githubusercontent.com/selva86/datasets/master/email_campaign_funnel.csv")

# X Axis Breaks and Labels 
brks <- seq(-15000000, 15000000, 5000000)
lbls = paste0(as.character(c(seq(15, 0, -5), seq(5, 15, 5))), "m")

# Plot
ggplot(email_campaign_funnel, aes(x = Stage, y = Users, fill = Gender)) +   # Fill column
                              geom_bar(stat = "identity", width = .6) +   # draw the bars
                              scale_y_continuous(breaks = brks,   # X-axis Breaks
                                                 labels = lbls) + # X-axis Labels
                              coord_flip() +  # Flip axes
                              labs(title="Email Campaign Funnel") +
                              theme_tufte() +  # Tufte theme from ggfortify
                              theme(plot.title = element_text(hjust = .5), 
                                    axis.ticks = element_blank()) +   # Centre plot title
                              scale_fill_brewer(palette = "Dark2")  # Color palette
# my try
#should be 2 entries (one for each sex) for each of the 24 districts 

new_df <- data.frame(matrix(ncol = 3, nrow = 0))
for (row in rownames(test)){
  for (col in colnames(test)){
    #row in new dataframe
    #(sex, district, value)
    new_df <- rbind(new_df, c(row, col, test[row, col]))
  }
}
colnames(new_df) <- c("sex", "district", "count")
new_df$count <- as.numeric(new_df$count)
new_df$district <- as.factor(new_df$district)

mens <- new_df[new_df$sex == "male",]
mens$count <- (mens$count * -1)
new_df <- rbind(new_df[new_df$sex == "female",], mens)
new_df

new_df$district <- factor(new_df$district, ordered = TRUE)
levels(new_df$district)

brks <- seq(-70, 70, 10)
lbls = paste0(as.character(c(seq(70, 0, -10), seq(10, 70, 10))), "m")

# Plot
library(ggfortify)
ggplot(new_df, aes(x = district, y = count, fill = sex)) +   # Fill column
                              geom_bar(stat = "identity", width = .6) +   # draw the bars
                              scale_y_discrete(breaks = brks, labels = lbls) + 
                              coord_flip() +  # Flip axes
                              labs(title="title") +
                              theme_tufte() +  # Tufte theme from ggfortify
                              theme(plot.title = element_text(hjust = .5), 
                                    axis.ticks = element_blank()) +   # Centre plot title
                              scale_fill_brewer(palette = "Dark2")  # Color palette
# my try

```


## Plot 6: Citations by Race
```{r Race to citation ratio}
df <- data.frame(table(na.omit(mini_htx$subject_race)))
total_freq <- sum(df$Freq)
df$prop <- df$Freq/total_freq
num_squares <- round(df$prop*100)


df_grid <- data.frame(
 x = rep(1:10, each = 10),
 y = rep(1:10, times = 10)
)


df_grid$category <- rep(df$Var1, num_squares)
ggplot(df_grid, aes(x = x, y = y, fill = category)) +
 geom_tile(color = "black", size = 0.5) +
 scale_fill_brewer(palette = "Set3") +
 labs(title="Waffle Chart of Citations per Race")+
 theme_void()
```

Now we will look at the % of Citation by Race. As we can see, white individuals have the highest percentage of citations, followed by black individuals, and then Asian/pacific islanders, then unknown races. This is somewhat proportional to the actual demographics of Houston (according to the U.S. census) â€“ the White and Black percentages of citations are slightly higher than their population in Houston, while the proportion of citations for Asian individuals is slightly lower than the proportion of Asian people in Houston.